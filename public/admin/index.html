<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GM后台 - 文字传奇</title>
  <link rel="stylesheet" href="admin.css?v=3">
</head>
<body>
  <div class="wrap">
    <header>
      <h1>GM 后台</h1>
      <p>账号、角色、邮件、VIP 管理</p>
      <div class="header-actions">
        <button id="theme-toggle" class="btn-small">切换暗色</button>
        <button id="collapse-all" class="btn-small">折叠全部</button>
      </div>
    </header>

    <section id="login" class="panel">
      <h2>管理员登录</h2>
      <input id="admin-user" type="text" placeholder="管理员账号">
      <input id="admin-pass" type="password" placeholder="管理员密码">
      <button id="admin-login-btn">登录</button>
      <div id="login-msg" class="msg"></div>
    </section>

    <section id="dashboard" class="panel hidden">
      <div class="grid">
        <div class="block full" data-collapsible>
          <div class="block-title">
            <h2>区服管理</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <div class="row" style="margin-bottom: 8px;">
              <input id="realm-name-input" type="text" placeholder="区服名称" style="max-width: 200px;">
              <button id="realm-create-btn" class="btn-small">创建新区</button>
              <button id="realm-refresh-btn" class="btn-small">刷新列表</button>
              <button id="fix-realm-btn" class="btn-small" style="background: #ff9800;">修复旧数据</button>
            </div>
            <table id="realms-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>区名</th>
                  <th>角色数</th>
                  <th>行会数</th>
                  <th>创建时间</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="realms-list">
                <tr>
                  <td colspan="6" style="text-align: center; color: #999;">加载中...</td>
                </tr>
              </tbody>
            </table>
            <div id="realms-msg" class="msg"></div>
          </div>
        </div>

        <div class="block full" data-collapsible>
          <div class="block-title">
            <h2>用户与权限</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
          <div class="row">
            <button id="refresh-users">刷新列表</button>
          </div>
          <div class="table-container">
            <div class="row" style="margin-bottom: 8px;">
              <input id="users-search" type="text" placeholder="搜索用户名">
              <button id="users-search-btn" class="btn-small">搜索</button>
            </div>
            <table id="users-table">
              <thead>
                <tr>
                  <th>用户名</th>
                  <th>GM权限</th>
                  <th>创建时间</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="users-list">
                <tr>
                  <td colspan="4" style="text-align: center; color: #999;">加载中...</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="row" style="margin-top: 12px;">
            <div id="users-pagination-info" style="color: #666;"></div>
            <div>
              <button id="users-prev-page" class="btn-small">上一页</button>
              <button id="users-next-page" class="btn-small">下一页</button>
            </div>
          </div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>世界BOSS设置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p style="color: #666; margin-bottom: 6px; font-size: 13px;">基础属性</p>
            <div class="row" style="margin-bottom: 4px; font-size: 13px; gap: 4px;">
              <label style="min-width: 40px;">生命:</label>
              <input id="wb-base-hp" type="number" min="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 40px;">攻击:</label>
              <input id="wb-base-atk" type="number" min="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
            </div>
            <div class="row" style="margin-bottom: 4px; font-size: 13px; gap: 4px;">
              <label style="min-width: 40px;">防御:</label>
              <input id="wb-base-def" type="number" min="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 40px;">魔御:</label>
              <input id="wb-base-mdef" type="number" min="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
            </div>
            <div class="row" style="margin-bottom: 4px; font-size: 13px; gap: 4px;">
              <label style="min-width: 40px;">经验:</label>
              <input id="wb-base-exp" type="number" min="1" step="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 40px;">金币:</label>
              <input id="wb-base-gold" type="number" min="0" step="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
            </div>
            <div class="row" style="margin-bottom: 6px; font-size: 13px; gap: 4px;">
              <label style="min-width: 40px;">掉落加成:</label>
              <input id="wb-drop-bonus" type="number" min="1" step="0.1" style="width: 70px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 70px;">刷新时间(分钟):</label>
              <input id="wb-respawn-mins" type="number" min="1" step="1" style="width: 70px; font-size: 13px; padding: 4px 6px;">
            </div>
              <div class="row" style="margin-bottom: 6px; font-size: 13px; gap: 6px; align-items: center; justify-content: flex-start; flex-wrap: wrap;">
                <label style="min-width: 40px;">区名:</label>
                <select id="wb-kill-realm" style="width: 90px; font-size: 13px; padding: 4px 6px;">
                  <option value="">加载中...</option>
                </select>
                <label style="min-width: 60px;">击杀次数:</label>
                <input id="wb-kill-count" type="number" min="0" step="1" style="width: 60px; font-size: 13px; padding: 4px 6px;">
              </div>
              <div class="row" style="margin-bottom: 6px; font-size: 13px; gap: 6px; align-items: center; justify-content: flex-start; flex-wrap: wrap;">
                <button id="wb-kill-save-btn" class="btn-small">保存</button>
                <button id="wb-kill-reset-btn" class="btn-small">清零</button>
              </div>
              <div id="wb-kill-msg" class="msg"></div>

            <p style="color: #666; margin: 10px 0 6px; font-size: 13px;">人数加成配置</p>
            <div class="table-container">
              <table style="font-size: 12px;">
                <thead>
                  <tr>
                    <th style="padding: 6px 8px;">最小人数</th>
                    <th style="padding: 6px 8px;">生命加成</th>
                    <th style="padding: 6px 8px;">攻击加成</th>
                    <th style="padding: 6px 8px;">防御加成</th>
                    <th style="padding: 6px 8px;">魔御加成</th>
                    <th style="padding: 6px 8px;">操作</th>
                  </tr>
                </thead>
                <tbody id="wb-player-bonus-list">
                  <tr>
                    <td colspan="6" style="text-align: center; color: #999;">点击加载获取数据</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="row" style="margin-top: 8px;">
              <button id="wb-add-bonus-btn" class="btn-small">+ 添加配置</button>
              <button id="wb-save-btn" class="btn-small">保存</button>
            </div>
            <div id="wb-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>特殊BOSS设置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p style="color: #666; margin-bottom: 6px; font-size: 13px;">基础属性（魔龙BOSS、暗之系列BOSS、沙巴克BOSS）</p>
            <div class="row" style="margin-bottom: 4px; font-size: 13px; gap: 4px;">
              <label style="min-width: 40px;">生命:</label>
              <input id="sb-base-hp" type="number" min="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 40px;">攻击:</label>
              <input id="sb-base-atk" type="number" min="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
            </div>
            <div class="row" style="margin-bottom: 4px; font-size: 13px; gap: 4px;">
              <label style="min-width: 40px;">防御:</label>
              <input id="sb-base-def" type="number" min="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 40px;">魔御:</label>
              <input id="sb-base-mdef" type="number" min="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
            </div>
            <div class="row" style="margin-bottom: 4px; font-size: 13px; gap: 4px;">
              <label style="min-width: 40px;">经验:</label>
              <input id="sb-base-exp" type="number" min="1" step="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 40px;">金币:</label>
              <input id="sb-base-gold" type="number" min="0" step="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
            </div>
            <div class="row" style="margin-bottom: 6px; font-size: 13px; gap: 4px;">
              <label style="min-width: 40px;">掉落加成:</label>
              <input id="sb-drop-bonus" type="number" min="1" step="0.1" style="width: 70px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 70px;">刷新时间(分钟):</label>
              <input id="sb-respawn-mins" type="number" min="1" step="1" style="width: 70px; font-size: 13px; padding: 4px 6px;">
            </div>
              <div class="row" style="margin-bottom: 6px; font-size: 13px; gap: 6px; align-items: center; justify-content: flex-start; flex-wrap: wrap;">
                <label style="min-width: 40px;">区名:</label>
                <select id="sb-kill-realm" style="width: 90px; font-size: 13px; padding: 4px 6px;">
                  <option value="">加载中...</option>
                </select>
                <label style="min-width: 60px;">击杀次数:</label>
                <input id="sb-kill-count" type="number" min="0" step="1" style="width: 60px; font-size: 13px; padding: 4px 6px;">
              </div>
              <div class="row" style="margin-bottom: 6px; font-size: 13px; gap: 6px; align-items: center; justify-content: flex-start; flex-wrap: wrap;">
                <button id="sb-kill-save-btn" class="btn-small">保存</button>
                <button id="sb-kill-reset-btn" class="btn-small">清零</button>
              </div>
              <div id="sb-kill-msg" class="msg"></div>

            <p style="color: #666; margin: 10px 0 6px; font-size: 13px;">人数加成配置</p>
            <div class="table-container">
              <table style="font-size: 12px;">
                <thead>
                  <tr>
                    <th style="padding: 6px 8px;">最小人数</th>
                    <th style="padding: 6px 8px;">生命加成</th>
                    <th style="padding: 6px 8px;">攻击加成</th>
                    <th style="padding: 6px 8px;">防御加成</th>
                    <th style="padding: 6px 8px;">魔御加成</th>
                    <th style="padding: 6px 8px;">操作</th>
                  </tr>
                </thead>
                <tbody id="sb-player-bonus-list">
                  <tr>
                    <td colspan="6" style="text-align: center; color: #999;">点击加载获取数据</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="row" style="margin-top: 8px;">
              <button id="sb-add-bonus-btn" class="btn-small">+ 添加配置</button>
              <button id="sb-save-btn" class="btn-small">保存</button>
            </div>
            <div id="sb-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>修真BOSS设置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body cmd-rate-settings">
            <p style="color: #666; margin-bottom: 6px; font-size: 13px;">基础属性</p>
            <div class="row" style="margin-bottom: 4px; font-size: 13px; gap: 4px;">
              <label style="min-width: 40px;">生命:</label>
              <input id="cb-base-hp" type="number" min="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 40px;">攻击:</label>
              <input id="cb-base-atk" type="number" min="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
            </div>
            <div class="row" style="margin-bottom: 4px; font-size: 13px; gap: 4px;">
              <label style="min-width: 40px;">防御:</label>
              <input id="cb-base-def" type="number" min="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 40px;">魔御:</label>
              <input id="cb-base-mdef" type="number" min="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
            </div>
            <div class="row" style="margin-bottom: 4px; font-size: 13px; gap: 4px;">
              <label style="min-width: 40px;">经验:</label>
              <input id="cb-base-exp" type="number" min="1" step="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 40px;">金币:</label>
              <input id="cb-base-gold" type="number" min="0" step="1" style="width: 90px; font-size: 13px; padding: 4px 6px;">
            </div>
            <div class="row" style="margin-bottom: 6px; font-size: 13px; gap: 4px;">
              <label style="min-width: 40px;">掉落加成:</label>
              <input id="cb-drop-bonus" type="number" min="1" step="0.1" style="width: 70px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 70px;">刷新时间(分钟):</label>
              <input id="cb-respawn-mins" type="number" min="1" step="1" style="width: 70px; font-size: 13px; padding: 4px 6px;">
            </div>
            <div class="row" style="margin-bottom: 6px; font-size: 13px; gap: 6px; align-items: center; justify-content: flex-start; flex-wrap: wrap;">
              <label style="min-width: 40px;">区名:</label>
              <select id="cb-kill-realm" style="width: 90px; font-size: 13px; padding: 4px 6px;">
                <option value="">加载中...</option>
              </select>
              <label style="min-width: 60px;">击杀次数:</label>
              <input id="cb-kill-count" type="number" min="0" step="1" style="width: 60px; font-size: 13px; padding: 4px 6px;">
            </div>
            <div class="row" style="margin-bottom: 6px; font-size: 13px; gap: 6px; align-items: center; justify-content: flex-start; flex-wrap: wrap;">
              <button id="cb-kill-save-btn" class="btn-small">保存</button>
              <button id="cb-kill-reset-btn" class="btn-small">清零</button>
            </div>
            <div id="cb-kill-msg" class="msg"></div>
            <p style="color: #666; margin: 10px 0 6px; font-size: 13px;">人数加成配置</p>
            <div class="table-container">
              <table style="font-size: 12px;">
                <thead>
                  <tr>
                    <th style="padding: 6px 8px;">最小人数</th>
                    <th style="padding: 6px 8px;">生命加成</th>
                    <th style="padding: 6px 8px;">攻击加成</th>
                    <th style="padding: 6px 8px;">防御加成</th>
                    <th style="padding: 6px 8px;">魔御加成</th>
                    <th style="padding: 6px 8px;">操作</th>
                  </tr>
                </thead>
                <tbody id="cb-player-bonus-list">
                  <tr>
                    <td colspan="6" style="text-align: center; color: #999;">点击加载获取数据</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="row" style="margin-top: 8px;">
              <button id="cb-add-bonus-btn" class="btn-small">+ 添加配置</button>
              <button id="cb-save-btn" class="btn-small">保存</button>
            </div>
            <div id="cb-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>活动时间设置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p style="color: #666; margin-bottom: 6px; font-size: 13px;">沙巴克攻城</p>
            <div class="row" style="margin-bottom: 6px; font-size: 13px; gap: 6px; align-items: center; justify-content: flex-start; flex-wrap: wrap;">
              <label style="min-width: 60px;">开始时间:</label>
              <input id="sabak-time-start-hour" type="number" min="0" max="23" step="1" placeholder="20" style="width: 60px; font-size: 13px; padding: 4px 6px;">
              <span>:</span>
              <input id="sabak-time-start-minute" type="number" min="0" max="59" step="1" placeholder="00" style="width: 60px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 70px;">攻城时间:</label>
              <input id="sabak-time-duration" type="number" min="1" step="1" placeholder="10" style="width: 70px; font-size: 13px; padding: 4px 6px;">
              <span>分钟</span>
            </div>

            <p style="color: #666; margin: 10px 0 6px; font-size: 13px;">跨服排位赛</p>
            <div class="row" style="margin-bottom: 6px; font-size: 13px; gap: 6px; align-items: center; justify-content: flex-start; flex-wrap: wrap;">
              <label style="min-width: 60px;">开始时间:</label>
              <input id="cross-rank-start-hour" type="number" min="0" max="23" step="1" placeholder="19" style="width: 60px; font-size: 13px; padding: 4px 6px;">
              <span>:</span>
              <input id="cross-rank-start-minute" type="number" min="0" max="59" step="1" placeholder="00" style="width: 60px; font-size: 13px; padding: 4px 6px;">
              <label style="min-width: 70px;">时长:</label>
              <input id="cross-rank-duration" type="number" min="1" step="1" placeholder="10" style="width: 70px; font-size: 13px; padding: 4px 6px;">
              <span>分钟</span>
            </div>

            <div class="row" style="margin-top: 8px;">
              <button id="event-time-save-btn" class="btn-small">保存</button>
            </div>
            <div id="event-time-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>每日幸运玩家</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p style="color: #666; margin-bottom: 8px; font-size: 13px;">
              每日0点自动抽取幸运玩家，获得称号"欧皇"和100%属性加成。
            </p>
            <div class="row" style="margin-bottom: 8px;">
              <button id="daily-lucky-refresh-btn" class="btn-small">立即刷新</button>
              <button id="daily-lucky-info-btn" class="btn-small">查看当前状态</button>
            </div>
            <div id="daily-lucky-msg" class="msg"></div>
            <div class="table-container" id="daily-lucky-table-container" style="display: none;">
              <table style="font-size: 12px;">
                <thead>
                  <tr>
                    <th>区服</th>
                    <th>日期</th>
                    <th>幸运玩家</th>
                    <th>加成属性</th>
                  </tr>
                </thead>
                <tbody id="daily-lucky-list"></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>VIP 设置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <div style="margin-bottom: 20px;">
              <h3>VIP 自助激活开关</h3>
              <p>当前状态: <span id="vip-self-claim-status">加载中...</span></p>
              <label class="admin-switch">
                <input type="checkbox" id="vip-self-claim-toggle">
                <span class="admin-switch-slider" aria-hidden="true"></span>
                <span class="admin-switch-label">开启自助激活</span>
              </label>
              <div id="vip-self-claim-msg" class="msg"></div>
            </div>

            <div style="border-top: 1px solid #ddd; padding-top: 20px;">
              <h3>VIP 激活码管理</h3>
              <input id="vip-count" type="number" min="1" max="100" value="5">
              <select id="vip-duration">
                <option value="month">月卡</option>
                <option value="quarter">季卡</option>
                <option value="year">年卡</option>
                <option value="permanent">永久</option>
              </select>
              <button id="vip-create-btn">生成激活码</button>
              <button id="vip-list-btn">查看激活码列表</button>
              <div class="row" style="margin-top: 8px;">
                <button id="vip-codes-prev" class="btn-small">上一页</button>
                <span id="vip-codes-page" class="muted" style="margin: 0 8px;">第 1/1 页</span>
                <button id="vip-codes-next" class="btn-small">下一页</button>
              </div>
              <div id="vip-codes-result" class="list"></div>
              
              <div class="table-container" id="vip-codes-table-container" style="display: none;">
                <table>
                  <thead>
                    <tr>
                      <th>激活码</th>
                      <th>类型</th>
                      <th>状态</th>
                      <th>使用者ID</th>
                      <th>使用时间</th>
                    </tr>
                  </thead>
                  <tbody id="vip-codes-list"></tbody>
                </table>
              </div>
            </div>

            <div style="border-top: 1px solid #ddd; padding-top: 20px;">
              <h3>SVIP 开通设置</h3>
              <div class="input-with-unit">
                <input id="svip-price-month" type="number" min="0" value="100">
                <span class="unit">元宝/月卡</span>
              </div>
              <div class="input-with-unit">
                <input id="svip-price-quarter" type="number" min="0" value="260">
                <span class="unit">元宝/季卡</span>
              </div>
              <div class="input-with-unit">
                <input id="svip-price-year" type="number" min="0" value="900">
                <span class="unit">元宝/年卡</span>
              </div>
              <div class="input-with-unit">
                <input id="svip-price-permanent" type="number" min="0" value="3000">
                <span class="unit">元宝/永久</span>
              </div>
              <button id="svip-save-btn">保存设置</button>
              <div id="svip-msg" class="msg"></div>
            </div>

            <div style="border-top: 1px solid #ddd; padding-top: 20px;">
              <h3>元宝卡密管理</h3>
              <div class="input-with-unit">
                <input id="recharge-count" type="number" min="1" max="200" value="5">
                <span class="unit">张</span>
              </div>
              <div class="input-with-unit">
                <input id="recharge-amount" type="number" min="1" value="100">
                <span class="unit">元宝</span>
              </div>
              <button id="recharge-create-btn">生成卡密</button>
              <button id="recharge-list-btn">查看卡密列表</button>
              <div class="row" style="margin-top: 8px;">
                <button id="recharge-codes-prev" class="btn-small">上一页</button>
                <span id="recharge-codes-page" class="muted" style="margin: 0 8px;">第 1/1 页</span>
                <button id="recharge-codes-next" class="btn-small">下一页</button>
              </div>
              <div id="recharge-codes-result" class="list"></div>

              <div class="table-container" id="recharge-codes-table-container" style="display: none;">
                <table>
                  <thead>
                    <tr>
                      <th>卡密</th>
                      <th>元宝</th>
                      <th>状态</th>
                      <th>使用者ID</th>
                      <th>使用角色</th>
                      <th>使用时间</th>
                    </tr>
                  </thead>
                  <tbody id="recharge-codes-list"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>掉落日志开关</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p>当前状态: <span id="loot-log-status">加载中...</span></p>
            <label class="admin-switch">
              <input type="checkbox" id="loot-log-toggle">
              <span class="admin-switch-slider" aria-hidden="true"></span>
              <span class="admin-switch-label">开启掉落日志</span>
            </label>
            <div id="loot-log-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>状态刷新节流</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p>当前状态: <span id="state-throttle-status">加载中...</span></p>
            <label class="admin-switch">
              <input type="checkbox" id="state-throttle-toggle">
              <span class="admin-switch-slider" aria-hidden="true"></span>
              <span class="admin-switch-label">开启节流</span>
            </label>
            <label class="admin-switch">
              <input type="checkbox" id="state-throttle-override-allowed">
              <span class="admin-switch-slider" aria-hidden="true"></span>
              <span class="admin-switch-label">允许前台正常刷新影响服务端</span>
            </label>
            <div class="row" style="margin-top: 6px;">
              <input id="state-throttle-interval" type="number" min="1" value="10" style="max-width: 120px;">
              <button id="state-throttle-save" class="btn-small">保存秒数</button>
            </div>
            <div id="state-throttle-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>寄售到期设置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p>当前状态: <span id="consign-expire-status">加载中...</span></p>
            <div class="row" style="margin-top: 6px;">
              <input id="consign-expire-hours" type="number" min="0" value="48" style="max-width: 120px;">
              <button id="consign-expire-save" class="btn-small">保存小时</button>
            </div>
            <p class="muted" style="margin-top: 6px;">0 表示不自动下架</p>
            <div id="consign-expire-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>房间变种数量</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p>当前状态: <span id="room-variant-status">加载中...</span></p>
            <div class="row" style="margin-top: 6px;">
              <input id="room-variant-count" type="number" min="1" value="5" style="max-width: 120px;">
              <button id="room-variant-save" class="btn-small">保存数量</button>
            </div>
            <p class="muted" style="margin-top: 6px;">修改后立即生效；减少时仅影响分流选择</p>
            <div id="room-variant-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>命令限频</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
            <div class="block-body cmd-rate-settings">
              <div class="cmd-rate-grid">
                <div class="cmd-rate-field">
                  <label>全局次数</label>
                  <input id="cmd-rate-global-limit" type="number" min="1" value="12">
                </div>
                <div class="cmd-rate-field">
                  <label>窗口(ms)</label>
                  <input id="cmd-rate-global-window" type="number" min="100" value="10000">
                </div>
                <div class="cmd-rate-action">
                  <button id="cmd-rate-save" class="btn-small">保存限频</button>
                </div>
              </div>
              <p class="muted">全局限频：次数 / 窗口毫秒</p>

              <div class="cmd-rate-grid">
                <div class="cmd-rate-field">
                  <label>突发次数</label>
                  <input id="cmd-rate-burst-limit" type="number" min="1" value="60">
                </div>
                <div class="cmd-rate-field">
                  <label>窗口(ms)</label>
                  <input id="cmd-rate-burst-window" type="number" min="100" value="10000">
                </div>
              </div>
              <p class="muted">突发限频：次数 / 窗口毫秒</p>

            <div class="cmd-rate-grid">
              <div class="cmd-rate-field">
                <label>寄售</label>
                <input id="cmd-cooldown-consign" type="number" min="0" value="800">
                </div>
                <div class="cmd-rate-field">
                  <label>交易</label>
                  <input id="cmd-cooldown-trade" type="number" min="0" value="800">
                </div>
                <div class="cmd-rate-field">
                  <label>邮件</label>
                  <input id="cmd-cooldown-mail" type="number" min="0" value="800">
                </div>
              </div>
              <p class="muted">命令冷却（毫秒）</p>
              <div id="cmd-rate-msg" class="msg"></div>
            </div>
          </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>修炼果设置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <div style="margin-bottom: 20px;">
              <h3>修炼果系数</h3>
              <p style="color: #666; margin-bottom: 8px; font-size: 13px;">
                控制修炼果对属性的加成效果。系数越大，每个修炼果提供的属性加成越高。<br>
                默认值: 0.5（每个修炼果+0.5点属性）
              </p>
            </div>

            <div style="border-top: 1px solid #ddd; padding-top: 20px; margin-bottom: 12px;">
              <h3>修炼果配置</h3>
              <p style="color: #666; margin-bottom: 12px; font-size: 13px;">
                控制修炼果对属性的加成效果和掉落概率。<br>
                系数默认值: 0.5，爆率默认值: 0.01（1%概率）
              </p>
              <div class="table-container">
                <table style="font-size: 12px;">
                  <thead>
                    <tr>
                      <th style="padding: 6px 8px;">属性</th>
                      <th style="padding: 6px 8px;">值</th>
                      <th style="padding: 6px 8px;">属性</th>
                      <th style="padding: 6px 8px;">值</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>系数</td>
                      <td><input id="tf-coefficient" type="number" step="0.1" min="0" style="width: 60px;"></td>
                      <td>爆率</td>
                      <td><input id="tf-drop-rate" type="number" step="0.001" min="0" max="1" style="width: 60px;"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <button id="tf-save-btn" class="btn-small">保存设置</button>
            <div id="tf-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>修炼系统设置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <div style="margin-bottom: 20px;">
              <h3>修炼系统每级效果配置</h3>
              <p style="color: #666; margin-bottom: 12px; font-size: 13px;">
                控制修炼系统每次修炼提升的属性值。<br>
                默认值: 生命/魔法值=1, 其他属性=0.1
              </p>
              <div class="table-container">
                <table style="font-size: 12px;">
                  <thead>
                    <tr>
                      <th style="padding: 6px 8px;">属性</th>
                      <th style="padding: 6px 8px;">每级增加</th>
                      <th style="padding: 6px 8px;">属性</th>
                      <th style="padding: 6px 8px;">每级增加</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>生命</td>
                      <td><input id="training-hp" type="number" step="0.1" min="0" style="width: 60px;"></td>
                      <td>魔法值</td>
                      <td><input id="training-mp" type="number" step="0.1" min="0" style="width: 60px;"></td>
                    </tr>
                    <tr>
                      <td>攻击</td>
                      <td><input id="training-atk" type="number" step="0.01" min="0" style="width: 60px;"></td>
                      <td>防御</td>
                      <td><input id="training-def" type="number" step="0.01" min="0" style="width: 60px;"></td>
                    </tr>
                    <tr>
                      <td>魔法</td>
                      <td><input id="training-mag" type="number" step="0.01" min="0" style="width: 60px;"></td>
                      <td>魔御</td>
                      <td><input id="training-mdef" type="number" step="0.01" min="0" style="width: 60px;"></td>
                    </tr>
                    <tr>
                      <td>道术</td>
                      <td><input id="training-spirit" type="number" step="0.01" min="0" style="width: 60px;"></td>
                      <td>敏捷</td>
                      <td><input id="training-dex" type="number" step="0.01" min="0" style="width: 60px;"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <button id="training-save-btn" class="btn-small">保存设置</button>
              <div id="training-msg" class="msg"></div>
            </div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>锻造系统配置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <div style="margin-bottom: 20px;">
              <h3>锻造系统设置</h3>
              <p style="color: #666; margin-bottom: 12px; font-size: 13px;">
                控制锻造装备的成功率、所需材料数量和属性加成等。<br>
                默认值: 基础成功率50%, 衰减率3%, 材料数量20件, 每级加成1点
              </p>
              <div class="table-container">
                <table style="font-size: 12px;">
                  <thead>
                    <tr>
                      <th style="padding: 6px 8px;">属性</th>
                      <th style="padding: 6px 8px;">值</th>
                      <th style="padding: 6px 8px;">说明</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>基础成功率(%)</td>
                      <td><input id="refine-base-success-rate" type="number" step="0.1" min="1" max="100" style="width: 80px;"></td>
                      <td>第2级开始使用，最低1%</td>
                    </tr>
                    <tr>
                      <td>衰减率(%)</td>
                      <td><input id="refine-decay-rate" type="number" step="0.1" min="0" style="width: 80px;"></td>
                      <td>每10级降低的百分比</td>
                    </tr>
                    <tr>
                      <td>材料数量(件)</td>
                      <td><input id="refine-material-count" type="number" step="1" min="1" style="width: 80px;"></td>
                      <td>每次锻造需要的装备数量</td>
                    </tr>
                    <tr>
                      <td>每级加成值</td>
                      <td><input id="refine-bonus-per-level" type="number" step="0.1" min="0" style="width: 80px;"></td>
                      <td>每级锻造给所有属性加成的点数</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <button id="refine-save-btn" class="btn-small">保存设置</button>
            <div id="refine-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>法宝配置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p style="color: #666; margin-bottom: 12px; font-size: 13px;">
              控制法宝系统全局参数（立即生效）。<br>
              每段效果加成填写小数：`0.001 = 0.1%`
            </p>
            <div class="table-container">
              <table class="treasure-config-table" style="font-size: 12px;">
                <thead>
                  <tr>
                    <th style="padding: 6px 8px;">属性（说明）</th>
                    <th style="padding: 6px 8px;">值</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>法宝槽位数（可装备法宝数量）</td>
                    <td><input id="treasure-slot-count" type="number" min="1" step="1" style="width: 100px;"></td>
                  </tr>
                  <tr>
                    <td>法宝等级上限（单件法宝最高等级）</td>
                    <td><input id="treasure-max-level" type="number" min="1" step="1" style="width: 100px;"></td>
                  </tr>
                  <tr>
                    <td>升级消耗(经验丹)（每次升级消耗）</td>
                    <td><input id="treasure-upgrade-consume" type="number" min="1" step="1" style="width: 100px;"></td>
                  </tr>
                  <tr>
                    <td>升段消耗(同名)（每次升段消耗）</td>
                    <td><input id="treasure-advance-consume" type="number" min="1" step="1" style="width: 100px;"></td>
                  </tr>
                  <tr>
                    <td>每阶所需段数（累计多少段升1阶）</td>
                    <td><input id="treasure-advance-per-stage" type="number" min="1" step="1" style="width: 100px;"></td>
                  </tr>
                  <tr>
                    <td>每段效果加成（0.001=0.1%）</td>
                    <td><input id="treasure-advance-bonus-per-stack" type="number" min="0" step="0.0001" style="width: 100px;"></td>
                  </tr>
                  <tr>
                    <td>世界BOSS法宝掉率倍率（1默认/2双倍/0关闭）</td>
                    <td><input id="treasure-world-boss-drop-multiplier" type="number" min="0" step="0.1" style="width: 100px;"></td>
                  </tr>
                  <tr>
                    <td>跨服BOSS法宝掉率倍率（仅作用跨服法宝掉落）</td>
                    <td><input id="treasure-cross-boss-drop-multiplier" type="number" min="0" step="0.1" style="width: 100px;"></td>
                  </tr>
                  <tr>
                    <td>浮图塔玄冥掉率（0~1，如0.2=20%）</td>
                    <td><input id="treasure-tower-xuanming-drop-chance" type="number" min="0" max="1" step="0.01" style="width: 100px;"></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button id="treasure-save-btn" class="btn-small">保存设置</button>
            <div id="treasure-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>特效重置配置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <div style="margin-bottom: 20px;">
              <h3>特效重置设置</h3>
              <p style="color: #666; margin-bottom: 12px; font-size: 13px;">
                控制装备特效重置的成功率和多特效概率。<br>
                默认值: 成功率0.1%, 双特效概率0.01%, 3特效概率0.001%, 4特效概率0.0001%, 5特效概率0.00001%
              </p>
              <div class="table-container">
                <table style="font-size: 12px;">
                  <thead>
                    <tr>
                      <th style="padding: 6px 8px;">属性</th>
                      <th style="padding: 6px 8px;">值</th>
                      <th style="padding: 6px 8px;">说明</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>成功率(%)</td>
                      <td><input id="effect-reset-success-rate" type="number" step="0.001" min="0" max="100" style="width: 80px;"></td>
                      <td>重置特效的成功概率</td>
                    </tr>
                    <tr>
                      <td>双特效概率(%)</td>
                      <td><input id="effect-reset-double-rate" type="number" step="0.001" min="0" max="100" style="width: 80px;"></td>
                      <td>同时获得2条特效的概率</td>
                    </tr>
                    <tr>
                      <td>3特效概率(%)</td>
                      <td><input id="effect-reset-triple-rate" type="number" step="0.001" min="0" max="100" style="width: 80px;"></td>
                      <td>同时获得3条特效的概率</td>
                    </tr>
                    <tr>
                      <td>4特效概率(%)</td>
                      <td><input id="effect-reset-quadruple-rate" type="number" step="0.001" min="0" max="100" style="width: 80px;"></td>
                      <td>同时获得4条特效的概率</td>
                    </tr>
                    <tr>
                      <td>5特效概率(%)</td>
                      <td><input id="effect-reset-quintuple-rate" type="number" step="0.001" min="0" max="100" style="width: 80px;"></td>
                      <td>同时获得5条特效的概率</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div style="margin-bottom: 20px;">
              <h3>特效装备掉落设置</h3>
              <p style="color: #666; margin-bottom: 12px; font-size: 13px;">
                控制怪物掉落特效装备的概率。<br>
                默认值: 单特效概率0.9%, 双特效概率0.1%, 附加技能概率0.5%
              </p>
              <div class="table-container">
                <table style="font-size: 12px;">
                  <thead>
                    <tr>
                      <th style="padding: 6px 8px;">属性</th>
                      <th style="padding: 6px 8px;">值</th>
                      <th style="padding: 6px 8px;">说明</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>单特效掉落概率(%)</td>
                      <td><input id="effect-drop-single-chance" type="number" step="0.001" min="0" max="100" style="width: 80px;"></td>
                      <td>掉落1条特效的概率</td>
                    </tr>
                    <tr>
                      <td>双特效掉落概率(%)</td>
                      <td><input id="effect-drop-double-chance" type="number" step="0.001" min="0" max="100" style="width: 80px;"></td>
                      <td>掉落2条特效的概率</td>
                    </tr>
                    <tr>
                      <td>附加技能掉落概率(%)</td>
                      <td><input id="equip-skill-drop-chance" type="number" step="0.001" min="0" max="100" style="width: 80px;"></td>
                      <td>装备附加技能出现的概率</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <button id="effect-reset-save-btn" class="btn-small">保存设置</button>
            <div id="effect-reset-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>职业升级属性配置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <div style="margin-bottom: 12px;">
              <label for="class-select" style="font-weight: bold;">选择职业:</label>
              <select id="class-select" style="max-width: 150px; margin-left: 8px;">
                <option value="warrior">战士</option>
                <option value="mage">法师</option>
                <option value="taoist">道士</option>
              </select>
            </div>
            <div class="table-container">
              <table style="font-size: 12px;">
                <thead>
                  <tr>
                    <th style="padding: 6px 8px;">属性</th>
                    <th style="padding: 6px 8px;">每级增加</th>
                    <th style="padding: 6px 8px;">属性</th>
                    <th style="padding: 6px 8px;">每级增加</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>HP</td>
                    <td><input id="class-bonus-hp" type="number" step="0.1" style="width: 60px;"></td>
                    <td>MP</td>
                    <td><input id="class-bonus-mp" type="number" step="0.1" style="width: 60px;"></td>
                  </tr>
                  <tr>
                    <td>攻击</td>
                    <td><input id="class-bonus-atk" type="number" step="0.1" style="width: 60px;"></td>
                    <td>防御</td>
                    <td><input id="class-bonus-def" type="number" step="0.1" style="width: 60px;"></td>
                  </tr>
                  <tr>
                    <td>魔法</td>
                    <td><input id="class-bonus-mag" type="number" step="0.1" style="width: 60px;"></td>
                    <td>魔御</td>
                    <td><input id="class-bonus-mdef" type="number" step="0.1" style="width: 60px;"></td>
                  </tr>
                  <tr>
                    <td>道术</td>
                    <td><input id="class-bonus-spirit" type="number" step="0.1" style="width: 60px;"></td>
                    <td>敏捷</td>
                    <td><input id="class-bonus-dex" type="number" step="0.1" style="width: 60px;"></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="row" style="margin-top: 12px;">
              <button id="class-bonus-save" class="btn-small">保存配置</button>
              <button id="class-bonus-reset" class="btn-small" style="background: #c00;">恢复默认</button>
            </div>
            <div id="class-bonus-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>赞助名单管理</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p class="muted" style="margin-bottom: 8px;">玩家名和金额由GM在后台设置，在前台显示前5位</p>
            <div class="row" style="margin-bottom: 8px;">
              <input id="sponsor-name" type="text" placeholder="玩家名" style="max-width: 150px;">
              <input id="sponsor-amount" type="number" min="0" placeholder="金额" style="max-width: 100px;">
              <button id="sponsor-add-btn" class="btn-small">添加</button>
            </div>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>排名</th>
                    <th>玩家名</th>
                    <th>金额</th>
                    <th>添加时间</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="sponsors-list">
                  <tr>
                    <td colspan="5" style="text-align: center; color: #999;">加载中...</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="row" style="margin-top: 12px;">
              <div id="sponsors-pagination-info" style="color: #666;"></div>
              <div>
                <button id="sponsors-prev-page" class="btn-small">上一页</button>
                <button id="sponsors-next-page" class="btn-small">下一页</button>
              </div>
            </div>
            <div id="sponsor-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>合区操作</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p style="color: #c00; margin-bottom: 8px;">⚠️ 合区会强制下线所有玩家，请谨慎操作！</p>
            <div class="row" style="margin-bottom: 8px;">
              <label for="merge-source-realm">源区服:</label>
              <select id="merge-source-realm" style="max-width: 200px;"></select>
            </div>
            <div class="row" style="margin-bottom: 8px;">
              <label for="merge-target-realm">目标区服:</label>
              <select id="merge-target-realm" style="max-width: 200px;"></select>
            </div>
            <button id="merge-realms-btn" class="btn-small" style="background: #c00;">执行合区</button>
            <div id="merge-msg" class="msg"></div>
          </div>
        </div>

        <div class="block full" data-collapsible>
          <div class="block-title">
            <h2>装备管理</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <div class="row" style="margin-bottom: 12px;">
              <input id="items-search" type="text" placeholder="搜索装备名称或ID" style="max-width: 200px;">
              <button id="items-search-btn" class="btn-small">搜索</button>
              <button id="items-refresh-btn" class="btn-small">刷新列表</button>
              <button id="items-create-btn" class="btn-small" style="background: #2196F3;">+ 新增装备</button>
              <button id="items-import-btn" class="btn-small" style="background: #4CAF50;">从游戏导入装备</button>
            </div>
            <div class="table-container">
              <table id="items-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>名称</th>
                    <th>类型</th>
                    <th>稀有度</th>
                    <th>攻击</th>
                    <th>魔法</th>
                    <th>道术</th>
                    <th>防御</th>
                    <th>魔御</th>
                    <th>敏捷</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="items-list">
                  <tr>
                    <td colspan="11" style="text-align: center; color: #999;">加载中...</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="row" style="margin-top: 12px;">
              <div id="items-pagination-info" style="color: #666;"></div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <button id="items-prev-page" class="btn-small">上一页</button>
                <span style="color: #666;">跳转到</span>
                <input id="items-page-input" type="number" min="1" style="width: 60px; padding: 4px 6px;">
                <button id="items-go-page" class="btn-small">前往</button>
                <button id="items-next-page" class="btn-small">下一页</button>
              </div>
            </div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>数据备份与导入</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p style="color: #666;">导入会覆盖当前全部数据，建议停服或确保无在线玩家。</p>
            <button id="backup-download">下载备份</button>
            <input id="import-file" type="file" accept="application/json">
            <button id="import-btn">导入备份</button>
            <div id="backup-msg" class="msg"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div id="admin-pw-modal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-title" id="admin-pw-title">修改密码</div>
      <div class="modal-text" id="admin-pw-text"></div>
      <input id="admin-pw-input" type="password" placeholder="新密码">
      <div class="modal-actions">
        <button id="admin-pw-cancel" class="btn-small">取消</button>
        <button id="admin-pw-submit">更新</button>
      </div>
    </div>
  </div>

  <!-- 通用确认对话框 -->
  <div id="confirm-modal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-title" id="confirm-title">确认操作</div>
      <div class="modal-text" id="confirm-text"></div>
      <div class="modal-actions">
        <button id="confirm-cancel" class="btn-small">取消</button>
        <button id="confirm-ok" class="btn-small">确定</button>
      </div>
    </div>
  </div>

  <!-- 通用提示对话框 -->
  <div id="alert-modal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-title" id="alert-title">提示</div>
      <div class="modal-text" id="alert-text"></div>
      <div class="modal-actions">
        <button id="alert-ok" class="btn-small">确定</button>
      </div>
    </div>
  </div>

  <!-- 通用输入对话框 -->
  <div id="prompt-modal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-title" id="prompt-title">输入</div>
      <div class="modal-text" id="prompt-text"></div>
      <input id="prompt-input" type="text">
      <div class="modal-actions">
        <button id="prompt-cancel" class="btn-small">取消</button>
        <button id="prompt-ok" class="btn-small">确定</button>
      </div>
    </div>
  </div>

  <!-- 装备编辑对话框 -->
  <div id="item-edit-modal" class="modal hidden">
    <div class="modal-card" style="max-width: 900px;">
      <div class="modal-title" id="item-edit-title">编辑装备</div>
      <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">

        <input id="item-edit-id" type="hidden">

        <div class="table-container">
          <table style="font-size: 13px;">
            <tbody>
              <tr>
                <td style="width: 80px;"><strong>装备ID:</strong></td>
                <td><input id="item-edit-item-id" type="text" class="input-compact"></td>
                <td style="width: 80px;"><strong>装备名称:</strong></td>
                <td><input id="item-edit-name" type="text" class="input-compact"></td>
              </tr>
              <tr>
                <td><strong>装备类型:</strong></td>
                <td>
                  <select id="item-edit-type" class="input-compact">
                    <option value="weapon">武器</option>
                    <option value="armor" data-type="chest">胸甲</option>
                    <option value="armor" data-type="head">头盔</option>
                    <option value="armor" data-type="feet">鞋子</option>
                    <option value="armor" data-type="waist">腰带</option>
                    <option value="accessory" data-type="neck">项链</option>
                    <option value="accessory" data-type="ring">戒指</option>
                    <option value="accessory" data-type="bracelet">手镯</option>
                    <option value="consumable">消耗品</option>
                    <option value="book">技能书</option>
                    <option value="material">材料</option>
                    <option value="currency">货币</option>
                  </select>
                </td>
                <td><strong>装备槽位:</strong></td>
                <td>
                  <select id="item-edit-slot" class="input-compact">
                    <option value="">无</option>
                    <option value="weapon">武器</option>
                    <option value="chest">胸甲</option>
                    <option value="head">头盔</option>
                    <option value="feet">鞋子</option>
                    <option value="waist">腰带</option>
                    <option value="neck">项链</option>
                    <option value="ring">戒指</option>
                    <option value="bracelet">手镯</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td><strong>稀有度:</strong></td>
                <td>
                  <select id="item-edit-rarity" class="input-compact">
                    <option value="common">普通</option>
                    <option value="uncommon">优秀</option>
                    <option value="rare">稀有</option>
                    <option value="epic">史诗</option>
                    <option value="legendary">传说</option>
                    <option value="supreme">至尊</option>
                    <option value="ultimate">终极</option>
                  </select>
                </td>
                <td><strong>价格:</strong></td>
                <td><input id="item-edit-price" type="number" min="0" class="input-compact"></td>
              </tr>
              <tr>
                <td><strong>攻击:</strong></td>
                <td><input id="item-edit-atk" type="number" min="0" class="input-compact"></td>
                <td><strong>魔法:</strong></td>
                <td><input id="item-edit-mag" type="number" min="0" class="input-compact"></td>
              </tr>
              <tr>
                <td><strong>道术:</strong></td>
                <td><input id="item-edit-spirit" type="number" min="0" class="input-compact"></td>
                <td><strong>生命值:</strong></td>
                <td><input id="item-edit-hp" type="number" min="0" class="input-compact"></td>
              </tr>
              <tr>
                <td><strong>魔法值:</strong></td>
                <td><input id="item-edit-mp" type="number" min="0" class="input-compact"></td>
                <td><strong>防御:</strong></td>
                <td><input id="item-edit-def" type="number" min="0" class="input-compact"></td>
              </tr>
              <tr>
                <td><strong>魔御:</strong></td>
                <td><input id="item-edit-mdef" type="number" min="0" class="input-compact"></td>
                <td><strong>敏捷:</strong></td>
                <td><input id="item-edit-dex" type="number" min="0" class="input-compact"></td>
              </tr>
            </tbody>
          </table>
        </div>

        <div style="margin-top: 16px;">
          <label class="admin-switch" style="margin-right: 24px;">
            <input id="item-edit-untradable" type="checkbox">
            <span class="admin-switch-slider" aria-hidden="true"></span>
            <span class="admin-switch-label">不可交易</span>
          </label>
          <label class="admin-switch" style="margin-right: 24px;">
            <input id="item-edit-unconsignable" type="checkbox">
            <span class="admin-switch-slider" aria-hidden="true"></span>
            <span class="admin-switch-label">不可寄售</span>
          </label>
          <label class="admin-switch" style="margin-right: 24px;">
            <input id="item-edit-boss-only" type="checkbox">
            <span class="admin-switch-slider" aria-hidden="true"></span>
            <span class="admin-switch-label">仅BOSS掉落</span>
          </label>
          <label class="admin-switch">
            <input id="item-edit-world-boss-only" type="checkbox">
            <span class="admin-switch-slider" aria-hidden="true"></span>
            <span class="admin-switch-label">仅世界BOSS掉落</span>
          </label>
          <label class="admin-switch" style="margin-left: 24px;">
            <input id="item-edit-cross-world-boss-only" type="checkbox">
            <span class="admin-switch-slider" aria-hidden="true"></span>
            <span class="admin-switch-label">仅跨服BOSS掉落</span>
          </label>
        </div>

        <div style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 16px;">
          <h3 style="margin-bottom: 12px;">掉落配置</h3>
          <div class="table-container">
            <table id="item-drops-table" style="font-size: 12px;">
              <thead>
                <tr>
                  <th style="padding: 6px 8px; width: 40%;">怪物</th>
                  <th style="padding: 6px 8px; width: 30%;">掉落概率</th>
                  <th style="padding: 6px 8px; width: 30%;">操作</th>
                </tr>
              </thead>
              <tbody id="item-drops-list">
                <tr>
                  <td colspan="3" style="text-align: center; color: #999;">暂无掉落配置</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div style="margin-top: 8px;">
            <select id="item-drop-mob-select" class="input-compact" style="max-width: 180px;">
              <option value="">选择怪物</option>
            </select>
            <input id="item-drop-chance" type="number" min="0" max="1" step="0.0001" placeholder="掉落概率 (0-1)" class="input-compact" style="max-width: 100px;">
            <button id="item-drop-add-btn" class="btn-small">添加掉落</button>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button id="item-edit-cancel" class="btn-small">取消</button>
        <button id="item-edit-save" class="btn-small">保存</button>
      </div>
    </div>
  </div>

  <!-- 导入装备对话框 -->
  <div id="items-import-modal" class="modal hidden">
    <div class="modal-card" style="max-width: 900px; max-height: 85vh; display: flex; flex-direction: column;">
      <div class="modal-title">从游戏导入装备</div>
      <div class="modal-body" style="flex: 1; overflow-y: auto; max-height: none;">
        <p class="modal-body-text" style="margin-bottom: 12px; font-size: 13px;">
          选择要从游戏代码（ITEM_TEMPLATES）中导入的装备。
          已导入的装备会显示为灰色。
        </p>
        <div class="table-container">
          <table id="import-items-table">
            <thead>
              <tr>
                <th style="width: 40px;"><input type="checkbox" id="import-select-all"></th>
                <th>名称</th>
                <th>类型</th>
                <th>稀有度</th>
                <th>主要属性</th>
                <th>价格</th>
                <th>状态</th>
              </tr>
            </thead>
            <tbody id="import-items-list">
              <tr>
                <td colspan="7" style="text-align: center; color: #999;">加载中...</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="row" style="margin-top: 12px;">
          <div id="import-items-info" style="color: #666;"></div>
        </div>
      </div>
      <div class="modal-actions" style="flex-shrink: 0;">
        <button id="import-items-cancel" class="btn-small">取消</button>
        <button id="import-items-confirm" class="btn-small" style="background: #4CAF50;">导入选中装备</button>
      </div>
    </div>
  </div>

  <script src="admin.js?v=9"></script>
</body>
</html>
