<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GM后台 - 文字传奇</title>
  <link rel="stylesheet" href="admin.css?v=3">
</head>
<body>
  <div class="wrap">
    <header>
      <h1>GM 后台</h1>
      <p>账号、角色、邮件、VIP 管理</p>
      <div class="header-actions">
        <button id="theme-toggle" class="btn-small">切换暗色</button>
        <button id="collapse-all" class="btn-small">折叠全部</button>
      </div>
    </header>

    <section id="login" class="panel">
      <h2>管理员登录</h2>
      <input id="admin-user" type="text" placeholder="管理员账号">
      <input id="admin-pass" type="password" placeholder="管理员密码">
      <button id="admin-login-btn">登录</button>
      <div id="login-msg" class="msg"></div>
    </section>

    <section id="dashboard" class="panel hidden">
      <div class="grid">
        <div class="block full" data-collapsible>
          <div class="block-title">
            <h2>区服管理</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <div class="row" style="margin-bottom: 8px;">
              <input id="realm-name-input" type="text" placeholder="区服名称" style="max-width: 200px;">
              <button id="realm-create-btn" class="btn-small">创建新区</button>
              <button id="realm-refresh-btn" class="btn-small">刷新列表</button>
              <button id="fix-realm-btn" class="btn-small" style="background: #ff9800;">修复旧数据</button>
            </div>
            <table id="realms-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>区名</th>
                  <th>角色数</th>
                  <th>行会数</th>
                  <th>创建时间</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="realms-list">
                <tr>
                  <td colspan="6" style="text-align: center; color: #999;">加载中...</td>
                </tr>
              </tbody>
            </table>
            <div id="realms-msg" class="msg"></div>
          </div>
        </div>

        <div class="block full" data-collapsible>
          <div class="block-title">
            <h2>用户与权限</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
          <div class="row">
            <button id="refresh-users">刷新列表</button>
          </div>
          <div class="table-container">
            <div class="row" style="margin-bottom: 8px;">
              <input id="users-search" type="text" placeholder="搜索用户名">
              <button id="users-search-btn" class="btn-small">搜索</button>
            </div>
            <table id="users-table">
              <thead>
                <tr>
                  <th>用户名</th>
                  <th>GM权限</th>
                  <th>创建时间</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="users-list">
                <tr>
                  <td colspan="4" style="text-align: center; color: #999;">加载中...</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="row" style="margin-top: 12px;">
            <div id="users-pagination-info" style="color: #666;"></div>
            <div>
              <button id="users-prev-page" class="btn-small">上一页</button>
              <button id="users-next-page" class="btn-small">下一页</button>
            </div>
          </div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>站内邮件</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <input id="mail-username" type="text" placeholder="用户名">
            <input id="mail-title" type="text" placeholder="标题">
            <textarea id="mail-body" placeholder="内容"></textarea>
            <button id="mail-send-btn">发送邮件</button>
            <div id="mail-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>世界BOSS设置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p style="color: #666; margin-bottom: 8px;">基础属性</p>
            <div class="row" style="margin-bottom: 4px;">
              <label style="min-width: 80px;">生命:</label>
              <input id="wb-base-hp" type="number" min="1" style="max-width: 120px;">
              <label style="min-width: 80px; margin-left: 8px;">攻击:</label>
              <input id="wb-base-atk" type="number" min="1" style="max-width: 120px;">
            </div>
            <div class="row" style="margin-bottom: 8px;">
              <label style="min-width: 80px;">防御:</label>
              <input id="wb-base-def" type="number" min="1" style="max-width: 120px;">
              <label style="min-width: 80px; margin-left: 8px;">魔御:</label>
              <input id="wb-base-mdef" type="number" min="1" style="max-width: 120px;">
            </div>
            <div class="row" style="margin-bottom: 8px;">
              <label style="min-width: 80px;">掉落加成:</label>
              <input id="wb-drop-bonus" type="number" min="1" step="0.1" style="max-width: 120px;">
            </div>

            <p style="color: #666; margin: 12px 0 8px;">人数加成配置</p>
            <div class="table-container">
              <table style="font-size: 12px;">
                <thead>
                  <tr>
                    <th style="padding: 6px 8px;">最小人数</th>
                    <th style="padding: 6px 8px;">生命加成</th>
                    <th style="padding: 6px 8px;">攻击加成</th>
                    <th style="padding: 6px 8px;">防御加成</th>
                    <th style="padding: 6px 8px;">魔御加成</th>
                    <th style="padding: 6px 8px;">操作</th>
                  </tr>
                </thead>
                <tbody id="wb-player-bonus-list">
                  <tr>
                    <td colspan="6" style="text-align: center; color: #999;">点击加载获取数据</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button id="wb-add-bonus-btn" class="btn-small" style="margin-top: 8px;">+ 添加配置</button>

            <div class="row" style="margin-top: 16px;">
              <button id="wb-load-btn" class="btn-small">加载</button>
              <button id="wb-save-btn" class="btn-small">保存</button>
            </div>
            <div id="wb-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>VIP 激活码</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <input id="vip-count" type="number" min="1" max="100" value="5">
            <button id="vip-create-btn">生成激活码</button>
            <button id="vip-list-btn">查看激活码列表</button>
            <div id="vip-codes-result" class="list"></div>
            
            <div class="table-container" id="vip-codes-table-container" style="display: none;">
              <table>
                <thead>
                  <tr>
                    <th>激活码</th>
                    <th>状态</th>
                    <th>使用者ID</th>
                    <th>使用时间</th>
                  </tr>
                </thead>
                <tbody id="vip-codes-list"></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>VIP 自助激活开关</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p>当前状态: <span id="vip-self-claim-status">加载中...</span></p>
            <label class="admin-switch">
              <input type="checkbox" id="vip-self-claim-toggle">
              <span class="admin-switch-slider" aria-hidden="true"></span>
              <span class="admin-switch-label">开启自助激活</span>
            </label>
            <div id="vip-self-claim-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>掉落日志开关</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p>当前状态: <span id="loot-log-status">加载中...</span></p>
            <label class="admin-switch">
              <input type="checkbox" id="loot-log-toggle">
              <span class="admin-switch-slider" aria-hidden="true"></span>
              <span class="admin-switch-label">开启掉落日志</span>
            </label>
            <div id="loot-log-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>状态刷新节流</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p>当前状态: <span id="state-throttle-status">加载中...</span></p>
            <label class="admin-switch">
              <input type="checkbox" id="state-throttle-toggle">
              <span class="admin-switch-slider" aria-hidden="true"></span>
              <span class="admin-switch-label">开启节流</span>
            </label>
            <label class="admin-switch">
              <input type="checkbox" id="state-throttle-override-allowed">
              <span class="admin-switch-slider" aria-hidden="true"></span>
              <span class="admin-switch-label">允许前台正常刷新影响服务端</span>
            </label>
            <div class="row" style="margin-top: 6px;">
              <input id="state-throttle-interval" type="number" min="1" value="10" style="max-width: 120px;">
              <button id="state-throttle-save" class="btn-small">保存秒数</button>
            </div>
            <div id="state-throttle-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>寄售到期设置</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p>当前状态: <span id="consign-expire-status">加载中...</span></p>
            <div class="row" style="margin-top: 6px;">
              <input id="consign-expire-hours" type="number" min="0" value="48" style="max-width: 120px;">
              <button id="consign-expire-save" class="btn-small">保存小时</button>
            </div>
            <p class="muted" style="margin-top: 6px;">0 表示不自动下架</p>
            <div id="consign-expire-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>房间变种数量</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p>当前状态: <span id="room-variant-status">加载中...</span></p>
            <div class="row" style="margin-top: 6px;">
              <input id="room-variant-count" type="number" min="1" value="5" style="max-width: 120px;">
              <button id="room-variant-save" class="btn-small">保存数量</button>
            </div>
            <p class="muted" style="margin-top: 6px;">修改后立即生效；减少时仅影响分流选择</p>
            <div id="room-variant-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>合区操作</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p style="color: #c00; margin-bottom: 8px;">⚠️ 合区会强制下线所有玩家，请谨慎操作！</p>
            <div class="row" style="margin-bottom: 8px;">
              <label for="merge-source-realm">源区服:</label>
              <select id="merge-source-realm" style="max-width: 200px;"></select>
            </div>
            <div class="row" style="margin-bottom: 8px;">
              <label for="merge-target-realm">目标区服:</label>
              <select id="merge-target-realm" style="max-width: 200px;"></select>
            </div>
            <button id="merge-realms-btn" class="btn-small" style="background: #c00;">执行合区</button>
            <div id="merge-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>数据备份与导入</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p style="color: #666;">导入会覆盖当前全部数据，建议停服或确保无在线玩家。</p>
            <button id="backup-download">下载备份</button>
            <input id="import-file" type="file" accept="application/json">
            <button id="import-btn">导入备份</button>
            <div id="backup-msg" class="msg"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div id="admin-pw-modal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-title" id="admin-pw-title">修改密码</div>
      <div class="modal-text" id="admin-pw-text"></div>
      <input id="admin-pw-input" type="password" placeholder="新密码">
      <div class="modal-actions">
        <button id="admin-pw-cancel" class="btn-small">取消</button>
        <button id="admin-pw-submit">更新</button>
      </div>
    </div>
  </div>

  <script src="admin.js?v=3"></script>
</body>
</html>
