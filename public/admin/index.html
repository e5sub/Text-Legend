<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GM后台 - 文字传奇</title>
  <link rel="stylesheet" href="admin.css">
</head>
<body>
  <div class="wrap">
    <header>
      <h1>GM 后台</h1>
      <p>账号、角色、邮件、VIP 管理</p>
      <div class="header-actions">
        <button id="theme-toggle" class="btn-small">切换暗色</button>
        <button id="collapse-all" class="btn-small">折叠全部</button>
      </div>
    </header>

    <section id="login" class="panel">
      <h2>管理员登录</h2>
      <input id="admin-user" type="text" placeholder="管理员账号">
      <input id="admin-pass" type="password" placeholder="管理员密码">
      <button id="admin-login-btn">登录</button>
      <div id="login-msg" class="msg"></div>
    </section>

    <section id="dashboard" class="panel hidden">
      <div class="grid">
        <div class="block full" data-collapsible>
          <div class="row">
            <div class="block-title">
              <h2>用户与权限</h2>
              <button class="btn-small block-toggle">折叠</button>
            </div>
            <button id="refresh-users">刷新列表</button>
          </div>
          <div class="block-body">
          <div class="table-container">
            <div class="row" style="margin-bottom: 8px;">
              <input id="users-search" type="text" placeholder="搜索用户名">
              <button id="users-search-btn" class="btn-small">搜索</button>
            </div>
            <table id="users-table">
              <thead>
                <tr>
                  <th>用户名</th>
                  <th>GM权限</th>
                  <th>创建时间</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="users-list">
                <tr>
                  <td colspan="4" style="text-align: center; color: #999;">加载中...</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="row" style="margin-top: 12px;">
            <div id="users-pagination-info" style="color: #666;"></div>
            <div>
              <button id="users-prev-page" class="btn-small">上一页</button>
              <button id="users-next-page" class="btn-small">下一页</button>
            </div>
          </div>
          <div class="divider"></div>
          <h3>设置 GM 权限</h3>
          <input id="promote-username" type="text" placeholder="用户名">
          <button id="promote-btn">设为 GM</button>
          <button id="demote-btn">取消 GM</button>
          <div id="promote-msg" class="msg"></div>
          <div class="divider"></div>
          <h3>修改玩家密码</h3>
          <input id="pw-username" type="text" placeholder="用户名">
          <input id="pw-new" type="password" placeholder="新密码">
          <button id="pw-update-btn">更新密码</button>
          <div id="pw-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>站内邮件</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <input id="mail-username" type="text" placeholder="用户名">
            <input id="mail-title" type="text" placeholder="标题">
            <textarea id="mail-body" placeholder="内容"></textarea>
            <button id="mail-send-btn">发送邮件</button>
            <div id="mail-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>角色修改</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <input id="char-username" type="text" placeholder="用户名">
            <input id="char-name" type="text" placeholder="角色名">
            <textarea id="char-patch" placeholder='JSON Patch，例如: {"gold":5000,"level":40}'></textarea>
            <button id="char-update-btn">更新角色</button>
            <div id="char-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>VIP 激活码</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <input id="vip-count" type="number" min="1" max="100" value="5">
            <button id="vip-create-btn">生成激活码</button>
            <button id="vip-list-btn">查看激活码列表</button>
            <div id="vip-codes-result" class="list"></div>
            
            <div class="table-container" id="vip-codes-table-container" style="display: none;">
              <table>
                <thead>
                  <tr>
                    <th>激活码</th>
                    <th>状态</th>
                    <th>使用者ID</th>
                    <th>使用时间</th>
                  </tr>
                </thead>
                <tbody id="vip-codes-list"></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>VIP 自助激活开关</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p>当前状态: <span id="vip-self-claim-status">加载中...</span></p>
            <button id="vip-self-claim-on">开启自助激活</button>
            <button id="vip-self-claim-off">关闭自助激活</button>
            <div id="vip-self-claim-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>掉落日志开关</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p>当前状态: <span id="loot-log-status">加载中...</span></p>
            <button id="loot-log-on">开启掉落日志</button>
            <button id="loot-log-off">关闭掉落日志</button>
            <div id="loot-log-msg" class="msg"></div>
          </div>
        </div>

        <div class="block" data-collapsible>
          <div class="block-title">
            <h2>数据备份与导入</h2>
            <button class="btn-small block-toggle">折叠</button>
          </div>
          <div class="block-body">
            <p style="color: #666;">导入会覆盖当前全部数据，建议停服或确保无在线玩家。</p>
            <button id="backup-download">下载备份</button>
            <input id="import-file" type="file" accept="application/json">
            <button id="import-btn">导入备份</button>
            <div id="backup-msg" class="msg"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script src="admin.js"></script>
</body>
</html>
